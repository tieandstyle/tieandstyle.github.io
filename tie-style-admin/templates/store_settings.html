<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Settings - Tie-Style Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/store_settings.css') }}">
</head>
<body>
    {% include 'includes/_navbar.html' %}
    
    <div class="container">
        <header class="page-header">
            <h2>‚öôÔ∏è Store Settings</h2>
            <p>Configure your store information</p>
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="POST" enctype="multipart/form-data" class="form-container">
            <div class="form-grid">
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    
                    <div class="form-group">
                        <label for="name">Store Name *</label>
                        <input type="text" 
                               id="name" 
                               name="name" 
                               value="{{ store.name }}"
                               required>
                    </div>

                    <div class="form-group">
                        <label for="handle">Store Handle</label>
                        <input type="text" 
                               id="handle" 
                               name="handle" 
                               value="{{ store.handle }}">
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" 
                                  name="description" 
                                  rows="3">{{ store.description }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="logo">Store Logo</label>
                        {% if store.logo %}
                            <div class="current-image">
                                <img src="{{ url_for('static', filename='../' + store.logo) }}" 
                                     alt="Store Logo"
                                     style="max-width: 150px;">
                            </div>
                        {% endif %}
                        <input type="file" id="logo" name="logo" accept="image/*">
                    </div>

                    <div class="form-group">
                        <label for="banner">Store Banner</label>
                        {% if store.bannerImage %}
                            <div class="current-image">
                                <img src="{{ url_for('static', filename='../' + store.bannerImage) }}" 
                                     alt="Store Banner"
                                     style="max-width: 300px;">
                            </div>
                        {% endif %}
                        <input type="file" id="banner" name="banner" accept="image/*">
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="form-section">
                    <h3>Contact Information</h3>
                    
                    <div class="form-group">
                        <label for="phone">Phone (E.164 format)</label>
                        <input type="tel" 
                               id="phone" 
                               name="phone" 
                               value="{{ store.contact.phoneE164 }}"
                               placeholder="+918110960489">
                    </div>

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" 
                               id="email" 
                               name="email" 
                               value="{{ store.contact.email }}">
                    </div>

                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea id="address" 
                                  name="address" 
                                  rows="3">{{ store.contact.address }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="instagram">Instagram URL</label>
                        <input type="url" 
                               id="instagram" 
                               name="instagram" 
                               value="{{ store.social.instagram }}">
                    </div>
                </div>

                <!-- Payment Settings -->
                <div class="form-section">
                    <h3>Payment Settings</h3>
                    
                    <div class="form-group">
                        <label for="gpayUpiId">GPay UPI ID</label>
                        <input type="text" 
                               id="gpayUpiId" 
                               name="gpayUpiId" 
                               value="{{ store.payments.gpayUpiId }}">
                    </div>

                    <div class="form-group">
                        <label for="payment_instructions">Payment Instructions</label>
                        <textarea id="payment_instructions" 
                                  name="payment_instructions" 
                                  rows="3">{{ store.payments.instructions }}</textarea>
                    </div>
                </div>

                <!-- Delivery Settings -->
                <div class="form-section">
                    <h3>Delivery Settings</h3>
                    
                    <div class="form-group">
                        <label for="delivery_areas">Delivery Areas</label>
                        <input type="text" 
                               id="delivery_areas" 
                               name="delivery_areas" 
                               value="{{ store.delivery.areas | join(', ') }}"
                               placeholder="Chennai, Bengaluru">
                        <small>Comma-separated list of cities/areas</small>
                    </div>

                    <div class="form-group">
                        <label for="shipping_policy">Shipping Policy</label>
                        <textarea id="shipping_policy" 
                                  name="shipping_policy" 
                                  rows="2">{{ store.delivery.shippingPolicy }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="returns_policy">Returns Policy</label>
                        <textarea id="returns_policy" 
                                  name="returns_policy" 
                                  rows="2">{{ store.delivery.returnsPolicy }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="delivery_rates">Delivery Rates (by State)</label>
                        <div class="delivery-rates-scroll">
                            <div class="delivery-rates-table-wrapper">
                                <table id="deliveryRatesTable" class="delivery-rates-table">
                                    <colgroup>
                                        <col class="state" />
                                        <col class="region" />
                                        <col class="charge" />
                                        <col class="actions" />
                                    </colgroup>
                                    <thead>
                                        <tr>
                                            <th>State</th>
                                            <th>Region</th>
                                            <th>Charge (‚Çπ)</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rate in store.delivery.rates | default([]) %}
                                        <tr>
                                            <td><input type="text" name="delivery_state[]" value="{{ rate.state }}" class="input" list="stateList" placeholder="Start typing‚Ä¶" required></td>
                                            <td><input type="text" name="delivery_region[]" value="{{ rate.region }}" class="input" list="regionList" placeholder="e.g., South India"></td>
                                            <td><input type="number" name="delivery_charge[]" value="{{ rate.charge_inr }}" min="0" step="1" class="input" placeholder="0" required></td>
                                            <td><button type="button" class="btn btn-danger" onclick="removeRateRow(this)">Remove</button></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="delivery-rates-actions">
                            <div class="action-buttons-inline">
                                <button type="button" class="btn" onclick="addRateRow()">‚ûï Add Rate</button>
                                <button type="button" class="btn" onclick="sortRateRows()">üî§ Sort A‚ÄìZ</button>
                                <button type="button" class="btn btn-danger" onclick="clearAllRates()">üóëÔ∏è Clear All</button>
                            </div>
                            <small class="text-muted">Tip: Use the suggestions while typing state and region for cleaner data.</small>
                        </div>

                        <!-- Suggestions for State and Region -->
                        <datalist id="stateList">
                            <option value="Andhra Pradesh"></option>
                            <option value="Arunachal Pradesh"></option>
                            <option value="Assam"></option>
                            <option value="Bihar"></option>
                            <option value="Chhattisgarh"></option>
                            <option value="Goa"></option>
                            <option value="Gujarat"></option>
                            <option value="Haryana"></option>
                            <option value="Himachal Pradesh"></option>
                            <option value="Jharkhand"></option>
                            <option value="Karnataka"></option>
                            <option value="Kerala"></option>
                            <option value="Madhya Pradesh"></option>
                            <option value="Maharashtra"></option>
                            <option value="Manipur"></option>
                            <option value="Meghalaya"></option>
                            <option value="Mizoram"></option>
                            <option value="Nagaland"></option>
                            <option value="Odisha"></option>
                            <option value="Punjab"></option>
                            <option value="Rajasthan"></option>
                            <option value="Sikkim"></option>
                            <option value="Tamil Nadu"></option>
                            <option value="Telangana"></option>
                            <option value="Tripura"></option>
                            <option value="Uttar Pradesh"></option>
                            <option value="Uttarakhand"></option>
                            <option value="West Bengal"></option>
                            <option value="Andaman and Nicobar Islands"></option>
                            <option value="Chandigarh"></option>
                            <option value="Dadra and Nagar Haveli and Daman and Diu"></option>
                            <option value="Delhi"></option>
                            <option value="Jammu and Kashmir"></option>
                            <option value="Ladakh"></option>
                            <option value="Lakshadweep"></option>
                            <option value="Puducherry"></option>
                        </datalist>
                        <datalist id="regionList">
                            <option value="North India"></option>
                            <option value="South India"></option>
                            <option value="East India"></option>
                            <option value="West India"></option>
                            <option value="Central India"></option>
                            <option value="North East India"></option>
                        </datalist>
                    </div>
                </div>

                <!-- Pricing Settings -->
                <div class="form-section">
                    <h3>Pricing Settings</h3>
                    
                    <div class="form-group">
                        <label for="tax_rate">Tax Rate (%)</label>
                        <input type="number" 
                               id="tax_rate" 
                               name="tax_rate" 
                               value="{{ store.pricing.taxRatePct }}"
                               step="0.1"
                               min="0">
                    </div>

                    <div class="form-group">
                        <label for="free_shipping_min">Free Shipping Minimum (‚Çπ)</label>
                        <input type="number" 
                               id="free_shipping_min" 
                               name="free_shipping_min" 
                               value="{{ store.pricing.freeShippingMin }}"
                               step="1"
                               min="0">
                        <small>Orders above this amount get free shipping (calculated based on selected state)</small>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <span class="icon">üíæ</span> Save Settings
                </button>
            </div>
        </form>
    </div>

    {% include 'includes/_footer.html' %}
    <script>
        // Delivery rates editor helpers
        function addRateRow() {
            const tbody = document.querySelector('#deliveryRatesTable tbody');
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="text" name="delivery_state[]" value="" class="input" list="stateList" placeholder="Start typing‚Ä¶" required></td>
                <td><input type="text" name="delivery_region[]" value="" class="input" list="regionList" placeholder="e.g., South India"></td>
                <td><input type="number" name="delivery_charge[]" value="0" min="0" step="1" class="input" placeholder="0" required></td>
                <td><button type="button" class="btn btn-danger" onclick="removeRateRow(this)">Remove</button></td>
            `;
            tbody.appendChild(tr);
        }

        function removeRateRow(button) {
            const tr = button.closest('tr');
            if (tr) tr.remove();
        }

        function sortRateRows() {
            const tbody = document.querySelector('#deliveryRatesTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            rows.sort((a, b) => {
                const aState = (a.querySelector('input[name="delivery_state[]"]').value || '').toLowerCase();
                const bState = (b.querySelector('input[name="delivery_state[]"]').value || '').toLowerCase();
                return aState.localeCompare(bState);
            });
            rows.forEach(r => tbody.appendChild(r));
        }

        function clearAllRates() {
            if (!confirm('Remove all delivery rate rows?')) return;
            const tbody = document.querySelector('#deliveryRatesTable tbody');
            tbody.innerHTML = '';
        }
    </script>
</body>
</html>
